<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cross-validation procedures for AMMI and BLUP • METAAB</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Cross-validation procedures for AMMI and BLUP">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">METAAB</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignettes_CROSS-VALIDATION.html">Cross-validation procedure</a>
    </li>
    <li>
      <a href="../articles/vignettes_AMMI.html">AMMI</a>
    </li>
    <li>
      <a href="../articles/vignettes_BLUP.html">BLUP</a>
    </li>
    <li>
      <a href="../articles/vignettes_INDEXES.html">Multivariate indexes</a>
    </li>
    <li>
      <a href="../articles/vignettes_BIOMETRY.html">Biometry</a>
    </li>
    <li>
      <a href="../articles/vignettes_HELPER.html">Helper</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../CODE_OF_CONDUCT.html">Code of Conduct</a>
    </li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
    <li>
      <a href="../LICENSE.html">Licence</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://www.researchgate.net/profile/Tiago_Olivoto2">ResearchGate</a>
</li>
<li>
  <a href="https://www.mendeley.com/profiles/tiago-olivoto/">Mendeley</a>
</li>
<li>
  <a href="https://github.com/TiagoOlivoto">Github</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="vignettes_CROSS-VALIDATION_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Cross-validation procedures for AMMI and BLUP</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/TiagoOlivoto/METAAB/blob/master/vignettes/vignettes_CROSS-VALIDATION.Rmd"><code>vignettes/vignettes_CROSS-VALIDATION.Rmd</code></a></small>
      <div class="hidden name"><code>vignettes_CROSS-VALIDATION.Rmd</code></div>

    </div>

    
    
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h1>
<p>A dataset called <code>data_ge</code> is provided to make reproducible examples. For more information, please, see <code><a href="../reference/data_ge.html">?data_ge</a></code>. Other data sets can be used provided that the following columns are in the dataset: environment, genotype, block/replicate and response variable(s).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Importing data</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(METAAB)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(cowplot) <span class="co"># used in this material to arrange the graphics</span>
dataset =<span class="st"> </span>data_ge</code></pre></div>
</div>
<div id="predictive-accuracy" class="section level1">
<h1 class="hasAnchor">
<a href="#predictive-accuracy" class="anchor"></a>Predictive accuracy</h1>
<p>The predictive accucary of both AMMI and BLUP models may be obtained using a cross-validation procedure implemented by the functions <code><a href="../reference/validation.AMMIF.html">validation.AMMIF()</a></code> and <code><a href="../reference/validation.blup.html">validation.blup()</a></code> The <code><a href="../reference/validation.AMMIF.html">validation.AMMIF()</a></code> function provides a complete cross-validation procedure for all member of AMMI model family (AMMI0-AMMIF) using replicate-based data, according to the diagram below: <img src="validation.png" alt="Diagram for cross-validation of AMMI models."> Automatically the first validation is carried out considering the AMMIF (all possible axis used). Considering this model, the original data set is split up into two sets: training set and validation set. The training set has all combinations (genotype x environment) with the number of replications informed in <code>nrepval</code> argument. The validation set has one replication that were not included in the training set. The splitting of the data set into training and validation sets depends on the design considered. For a Randomized Complete Block Design (default option) and the procedure we used in the article, completely blocks are randomly selected within environments, as suggested by <span class="citation">Piepho (<a href="#ref-Piepho:1994">1994</a>)</span>. The remaining block serves as validation data. If <code>design = "CRD"</code> is informed, thus declaring that a completely randomized design was used, single observations are randomized for each treatment (genotype-by-environment combination). This is the same procedure suggested by <span class="citation">Gauch and Zobel (<a href="#ref-Gauch:1988">1988</a>)</span>. The estimated values for each member of the AMMI model family in each re-sampling cycle are compared with the observed values in the validation data. Then, the Root Mean Square Prediction Difference is computed as follows:</p>
<p><span class="math display">\[
   RMSPD = 
   {\left[ {\left( {\sum\nolimits_{i = 1}^n {{{\left( {{{\hat y}_{ij}} - {y_{ij}}} \right)}^2}} } \right)/n} \right]^{0.5}}
\]</span></p>
<p>where <span class="math inline">\(\widehat{y}_{ij}\)</span> is the model predicted value; and <span class="math inline">\(y_{ij}\)</span> is the observed value in the validation set. The number of random selection of blocks/replicates (<em>n</em>) is defined in the argument <code>nboot</code>. At the end of the <em>n</em> cycles for all models, a list with all estimated RMSPD and the average of RMSPD is returned.</p>
<p>The function <code>validation.blup</code> provides a cross-validation of replicate-based data using mixed models. By default, complete blocks are randomly selected for each environment. The procedure for computing the RSME is identical to the above function.</p>
<p>The following code computes the cross-validation of the oat data set that, for simplicity, will use 200 re-sampling procedures. I suggest using a larger number, say, 1000.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
AMMIweat =<span class="st"> </span><span class="kw"><a href="../reference/validation.AMMIF.html">validation.AMMIF</a></span>(dataset,
                            <span class="dt">resp =</span> GY,
                            <span class="dt">gen =</span> GEN,
                            <span class="dt">env =</span> ENV,
                            <span class="dt">rep =</span> REP,
                            <span class="dt">nboot =</span> <span class="dv">200</span>,
                            <span class="dt">nrepval =</span> <span class="dv">2</span>)

<span class="co"># cross-validation for BLUP model</span>
BLUPweat =<span class="st"> </span><span class="kw"><a href="../reference/validation.blup.html">validation.blup</a></span>(dataset,
                            <span class="dt">resp =</span> GY,
                            <span class="dt">gen =</span> GEN,
                            <span class="dt">env =</span> ENV,
                            <span class="dt">rep =</span> REP,
                            <span class="dt">nboot =</span> <span class="dv">200</span>,
                            <span class="dt">nrepval =</span> <span class="dv">2</span>)</code></pre></div>
<p>A progress bar is shown by default (the examples are below). Thus, it is possible to verify the status of the cross-validation process. If necessary, the progress bar can be disabled by informing the argument <code>progbar = FALSE</code> in the function.</p>
<div class="figure">
<img src="printAMMI.png" alt="Progress bar for AMMI model family cross-validation process."><p class="caption">Progress bar for AMMI model family cross-validation process.</p>
</div>
<div class="figure">
<img src="printBLUP.png" alt="Progress bar for BLUP cross-validation process."><p class="caption">Progress bar for BLUP cross-validation process.</p>
</div>
<div id="printing-the-means-of-rmspd-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#printing-the-means-of-rmspd-estimates" class="anchor"></a>Printing the means of RMSPD estimates</h2>
<p>All outputs shown in tables were laid out using the R package kableExtra. The pdf file of this package can be found <a href="https://haozhu233.github.io/kableExtra/awesome_table_in_pdf.pdf">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/options">options</a></span>(<span class="dt">digits =</span> <span class="dv">4</span>)
RMSEweat =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(AMMIweat<span class="op">$</span>RMSPDmean, BLUPweat<span class="op">$</span>RMSPDmean)
RMSEweat =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(RMSEweat, <span class="dt">CROP =</span> <span class="st">"Wheat"</span>)
RMSEweat =<span class="st"> </span>RMSEweat[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(RMSEweat<span class="op">$</span>mean, <span class="dt">decreasing =</span> F),]</code></pre></div>
<table class="table table table-striped">
<thead><tr>
<th style="text-align:left;">
MODEL
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:left;">
CROP
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
BLUP
</td>
<td style="text-align:right;">
0.4074
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI2
</td>
<td style="text-align:right;">
0.4123
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI3
</td>
<td style="text-align:right;">
0.4130
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI4
</td>
<td style="text-align:right;">
0.4182
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI5
</td>
<td style="text-align:right;">
0.4193
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI8
</td>
<td style="text-align:right;">
0.4260
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMIF
</td>
<td style="text-align:right;">
0.4260
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI6
</td>
<td style="text-align:right;">
0.4261
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI7
</td>
<td style="text-align:right;">
0.4261
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI1
</td>
<td style="text-align:right;">
0.4308
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
<tr>
<td style="text-align:left;">
AMMI0
</td>
<td style="text-align:right;">
0.4334
</td>
<td style="text-align:left;">
Wheat
</td>
</tr>
</tbody>
</table>
<p>The results shown above are the means of the 1000 RMSPD estimates for each tested model and are presented from the most accurate model (smallest RMSPD value) to the least accurate model (highest RMSPD value).</p>
<p>We can print the result from <code>RMSPDweat</code> in basically two distinct ways. First, printing the results in the R environment using <code><a href="https://www.rdocumentation.org/packages/base/topics/print">print(RMSPDweat)</a></code> (this is not a good idea since we probably will need work with these results). The second option is to export the results to an editable file, such as a .csv, or .xlsx file. We have R packages that facilitate this procedure. Let’s do it. For example, to export the results to a .csv file, the command to be run is: <code><a href="https://www.rdocumentation.org/packages/utils/topics/write.table">utils::write.csv(RMSPDweat, file = "myfile.csv")</a></code>. This command will create a .csv file called “myfile” in the R directory. To export the results to a .xlsx file, the package <code>xlsx</code> is needed. After properly installed, the command will be then <code>xlsx::write.xls(RMSPDweat, file = "myfile2.xlsx")</code>.</p>
</div>
<div id="plotting-the-rmspd-values" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-the-rmspd-values" class="anchor"></a>Plotting the RMSPD values</h2>
<p>The values of the RMSPD estimates obtained in the cross-validation process may be plotted using the function<code><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot()</a></code> may be used.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># binding AMMI and BLUP RMSPDs</span>
RMSPDweat =<span class="st"> </span><span class="kw"><a href="../reference/bind_val.html">bind_val</a></span>(AMMIweat, BLUPweat)

<span class="co"># Plotting the RMSPD values</span>
p1 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(RMSPDweat)
p2 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(RMSPDweat, <span class="dt">width.boxplot =</span> <span class="fl">0.5</span>, <span class="dt">col.boxplot =</span> <span class="st">"transparent"</span>)
<span class="kw">plot_grid</span>(p1, p2, <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"p1"</span>, <span class="st">"p2"</span>))</code></pre></div>
<p><img src="vignettes_CROSS-VALIDATION_files/figure-html/unnamed-chunk-5-1.png" width="960" style="display: block; margin: auto;"></p>
<p>Six statistics are shown in this boxplot. The mean (black rhombus), the median (black line), the lower and upper hinges that correspond sto the first and third quartiles (the 25th and 75th percentiles, respectively). The upper whisker extends from the hinge to the largest value no further than <span class="math inline">\(1.5\times{IQR}\)</span> from the hinge (where IQR is the inter-quartile range). The lower whisker extends from the hinge to the smallest value at most <span class="math inline">\(1.5\times{IQR}\)</span> of the hinge. Data beyond the end of the whiskers are considered outlying points. If the condition <code>violin = TRUE</code>, a violin plot is added along with the boxplot. A violin plot is a compact display of a continuous distribution displayed in the same way as a boxplot.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Gauch:1988">
<p>Gauch, H.G, and Zobel R.W. 1988. “Predictive and Postdictive Success of Statistical Analyses of Yield Trials.” <em>Theor. Appl. Genet.</em> 76 (1): 1–10. doi:<a href="https://doi.org/10.1007/BF00288824">10.1007/BF00288824</a>.</p>
</div>
<div id="ref-Piepho:1994">
<p>Piepho, H.P. 1994. “Best Linear Unbiased Prediction (Blup) for Regional Yield Trials: A Comparison to Additive Main Effects and Multiplicative Interaction (Ammi) Analysis.” <em>Theor. Appl. Genet.</em> 89 (5): 647–54. doi:<a href="https://doi.org/10.1007/BF00222462">10.1007/BF00222462</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#getting-started">Getting started</a></li>
      <li>
<a href="#predictive-accuracy">Predictive accuracy</a><ul class="nav nav-pills nav-stacked">
<li><a href="#printing-the-means-of-rmspd-estimates">Printing the means of RMSPD estimates</a></li>
      <li><a href="#plotting-the-rmspd-values">Plotting the RMSPD values</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.researchgate.net/profile/Tiago_Olivoto2">Tiago Olivoto</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
